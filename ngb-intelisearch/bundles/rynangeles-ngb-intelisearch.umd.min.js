!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("lodash"),require("@angular/platform-browser"),require("@ng-bootstrap/ng-bootstrap")):"function"==typeof define&&define.amd?define("@rynangeles/ngb-intelisearch",["exports","@angular/core","rxjs","rxjs/operators","lodash","@angular/platform-browser","@ng-bootstrap/ng-bootstrap"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).rynangeles=e.rynangeles||{},e.rynangeles["ngb-intelisearch"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e._,e.ng.platformBrowser,e["@ng-bootstrap/ng-bootstrap"])}(this,(function(e,t,n,o,r,i,a){"use strict";var s=function(){};s.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new s},token:s,providedIn:"root"}),s.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],s.ctorParameters=function(){return[]};Object.create;function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a}var c,u;Object.create;!function(e){e[e.Logical=0]="Logical",e[e.Key=1]="Key",e[e.Operator=2]="Operator",e[e.Value=3]="Value"}(c||(c={})),function(e){e[e.Enter=13]="Enter",e[e.Backspace=8]="Backspace"}(u||(u={}));var h=function(e){return Object.keys(e).map((function(e){return Number(isNaN(Number(e)))})).reduce((function(e,t){return e+t}),0)},p=h,d=function(){function e(){this.logical=function(){return n.of([{value:"AND",label:"AND"},{value:"OR",label:"OR"}])},this.comparison=function(){return n.of([{value:"=",label:"equal"},{value:"!=",label:"not equal"},{value:"LIKE",label:"contains"},{value:">",label:"greater than"},{value:"<",label:"less than"}])},this.search=new t.EventEmitter,this.focus$=new n.Subject,this.click$=new n.Subject,this.tokens=[],this.inputModel="",this.inputFormatter=function(e){return e.value},this.tokenSearch=this.tokenSearch.bind(this)}return e.prototype.addToken=function(){var e=this.tokens.length?[]:[null];this.tokens.push(e),this.token=this.tokens[this.tokens.indexOf(e)]},e.prototype.ngOnInit=function(){this.addToken(),this.getSearchTokens()},e.prototype.saveSearchTokens=function(){var e=this.getSearchTokens();e.push(r.filter(this.tokens,(function(e){return e.length}))),window.localStorage.setItem("sf:"+this.name,JSON.stringify(r.takeRight(e,5)))},e.prototype.getSearchTokens=function(){var e=window.localStorage.getItem("sf:"+this.name);return this.searchTokens=JSON.parse(e)||[],this.searchTokens},e.prototype.clearSearchTokens=function(){window.localStorage.removeItem("sf:"+this.name),this.getSearchTokens()},e.prototype.tokensToString=function(e){return r.map(e,(function(e){return e.join("")})).join("&")},e.prototype.onSelectRecentSearch=function(e){this.tokens=e,this.addToken(),this.search.emit(this.tokens)},e.prototype.getInputPlaceholder=function(e){var t="Search";switch(e.length){case c.Logical:t="Seach Logical Operator";break;case c.Key:t="Seach Key";break;case c.Operator:t="Seach Comparison Operator";break;case c.Value:t="Seach Value";break;default:t="Seach..."}return t},e.prototype.onTypeheadKeydown=function(e){var t=this;switch(e.which?e.which:e.keyCode){case u.Enter:this.inputModel.length>0&&(e.preventDefault(),this.search.emit(function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}(this.tokens,[[this.inputModel]]))),this.tokens.length>1&&0===this.token.length&&(e.preventDefault(),this.search.emit(this.tokens),this.saveSearchTokens());break;case u.Backspace:this.inputModel.length||(e.preventDefault(),this.input.nativeElement.blur(),this.token.length||0===this.tokens.indexOf(this.token)||(this.tokens.pop(),this.token=r.last(this.tokens)),this.inputModel=this.token.pop()||"",1===this.tokens.length&&0===this.token.length&&(this.tokens.pop(),this.addToken()),setTimeout((function(){return t.input.nativeElement.focus()})))}},e.prototype.tokenSearch=function(){var e=this;return function(t){var i=t.pipe(o.debounceTime(200),o.distinctUntilChanged()),a=e.click$.pipe(o.filter((function(){return!e.typehead.isPopupOpen()}))),s=e.focus$;return n.merge(i,s,a).pipe(o.switchMap((function(t){var r;switch(e.token.length){case c.Logical:r=e.logical({type:"LOGICAL",property:null,term:t,count:10});break;case c.Key:r=e.keys({type:"KEY",property:null,term:t,count:10});break;case c.Operator:r=e.comparison({type:"COMPARISON",property:null,term:t,count:10});break;case c.Value:r=e.values({type:"VALUE",property:e.token[c.Key],term:t,count:10});break;default:r=n.of([])}return r.pipe(o.map((function(e){return{list:e,term:t}})))})),o.map((function(e){var t=e.list,n=e.term;return r.chain(t).filter((function(e){return e.toString().toLowerCase().indexOf(n.toLowerCase())>=0})).uniq().slice(0,10).value()})))}},e.prototype.tokenHandler=function(e){var t=this;e.preventDefault();var n=e.item.value;this.input.nativeElement.blur(),this.token.push(n),this.inputModel="",this.token.indexOf(n)===c.Value&&this.addToken(),setTimeout((function(){return t.input.nativeElement.focus()}))},e.prototype.selectToken=function(e){var t=this,n=this.tokens[e];n.length===h(c)&&(this.input.nativeElement.blur(),this.tokens.pop(),this.token=n,this.inputModel=this.token.pop(),setTimeout((function(){return t.input.nativeElement.focus()})))},e.prototype.removeToken=function(e){this.tokens.splice(e,1),this.search.emit(this.tokens)},e.prototype.clearTokens=function(){this.tokens.length=0,this.search.emit(this.tokens),this.addToken()},e}();d.decorators=[{type:t.Component,args:[{selector:"ngb-intelisearch[name]",template:'<div class="search-filter-box">\n  <div class="search-filter-box-recent-searches" ngbDropdown container="body">\n    <button class="btn btn-outline-secondary dropdown-toggle" type="button" ngbDropdownToggle\n      ngbTooltip="Recent Searches">\n      <i class="las la-history"></i>\n    </button>\n    <div class="dropdown-menu recent-searches p-0" ngbDropdownMenu>\n      <button (click)="onSelectRecentSearch(tokens)" class="dropdown-item px-2"\n        *ngFor="let tokens of searchTokens">{{tokensToString(tokens)}}</button>\n      <div role="separator" class="dropdown-divider m-0"></div>\n      <button class="dropdown-item px-2" (click)="clearSearchTokens()">Clear recent searches</button>\n    </div>\n  </div>\n  <div class="search-filter-box-container">\n    <ul class="tokens-container list-unstyled">\n      <ng-container *ngFor="let _token of tokens; let i = index;">\n        <li class="visual-token">\n          <div class="selectable" role="button" (click)="selectToken(i)">\n            <div *ngIf="_token[0]" class="logical">{{_token[0]}}</div>\n            <div *ngIf="_token[1]" class="key">{{_token[1]}}</div>\n            <div *ngIf="_token[2]" class="operator">{{_token[2]}}</div>\n            <div *ngIf="_token[3]" class="value">{{_token[3]}}</div>\n            <a *ngIf="_token[3]" class="remove" role="button" (click)="removeToken(i)">\n              <i class="las la-times"></i>\n            </a>\n          </div>\n        </li>\n        <li class="input-token" *ngIf="_token === token">\n          <input type="text" class="form-control" [placeholder]="getInputPlaceholder(token)" #input\n            #typehead="ngbTypeahead" [focusFirst]="false" (keydown)="onTypeheadKeydown($event)"\n            (focus)="focus$.next($any($event).target.value)" (click)="click$.next($any($event).target.value)"\n            [(ngModel)]="inputModel" [ngbTypeahead]="tokenSearch()" [inputFormatter]="inputFormatter"\n            [resultTemplate]="resultTemplate" container="body" (selectItem)="tokenHandler($event)">\n        </li>\n      </ng-container>\n    </ul>\n    <a class="clear" role="button" (click)="clearTokens()" *ngIf="tokens.length > 1">\n      <i class="las la-times"></i>\n    </a>\n  </div>\n</div>\n<ng-template #resultTemplate let-result="result" let-term="term">\n  <ngb-highlight [result]="result.value" [term]="term"></ngb-highlight>\n  <span class="text-muted">{{ result.label }}</span>\n</ng-template>',styles:[".search-filter-box{display:flex}.search-filter-box .search-filter-box-recent-searches button{border-bottom-right-radius:0;border-color:#ced4da;border-top-right-radius:0}.search-filter-box .search-filter-box-recent-searches button:after{display:none}.search-filter-box .search-filter-box-recent-searches button i{font-size:1.5rem;vertical-align:middle}.search-filter-box .search-filter-box-container{align-items:center;background-color:#fff;border:1px solid #ced4da;border-bottom-left-radius:0!important;border-left-width:0;border-radius:.25rem;border-top-left-radius:0!important;display:flex;flex:1;overflow-y:auto}.search-filter-box .search-filter-box-container .tokens-container{align-items:center;display:flex;flex:1;margin:0;padding-left:.5rem}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable{align-items:center;display:flex}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable .remove,.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable div{align-items:center;background-color:#e7e7e7;color:#818181;font-size:.9rem;margin-right:.1rem;padding:.25rem .5rem;white-space:nowrap}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable .remove.value,.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable div.value{color:#000;margin:0}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable .remove{padding-left:0;text-decoration:none}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable .remove:hover{color:#000}.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable:hover .remove,.search-filter-box .search-filter-box-container .tokens-container li.visual-token .selectable:hover div{background-color:#d4d4d4}.search-filter-box .search-filter-box-container .tokens-container li.input-token:last-child{flex:1}.search-filter-box .search-filter-box-container .tokens-container li.input-token input{border:none;border-radius:0;box-shadow:none;height:calc(1.5em + .75rem);padding:.25rem}.search-filter-box .search-filter-box-container .clear{color:#818181;padding:.25rem .5rem;text-decoration:none}.search-filter-box .search-filter-box-container .clear:hover{color:#000}::ng-deep .recent-searches{max-width:250px;overflow:hidden}::ng-deep .recent-searches .dropdown-item{font-size:.9rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}::ng-deep .recent-searches .dropdown-item:last-child{color:#666}::ng-deep [id^=ngb-typeahead-]{z-index:99996}::ng-deep [id^=ngb-typeahead-] .dropdown-item{display:flex;justify-content:space-between;padding:.25rem .75rem}::ng-deep [id^=ngb-typeahead-] .dropdown-item.active{background-color:#e7e7e7;color:#000}"]}]}],d.ctorParameters=function(){return[]},d.propDecorators={input:[{type:t.ViewChild,args:["input",{static:!1}]}],typehead:[{type:t.ViewChild,args:["typehead",{static:!1}]}],name:[{type:t.Input}],keys:[{type:t.Input}],values:[{type:t.Input}],logical:[{type:t.Input}],comparison:[{type:t.Input}],search:[{type:t.Output}]};var f=function(){};f.decorators=[{type:t.NgModule,args:[{declarations:[d],imports:[i.BrowserModule,a.NgbModule],exports:[d]}]}],e.NgbIntelisearchComponent=d,e.NgbIntelisearchModule=f,e.NgbIntelisearchService=s,e.ɵ0=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rynangeles-ngb-intelisearch.umd.min.js.map